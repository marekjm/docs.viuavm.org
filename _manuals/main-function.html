---
number: 0
title: "Main function in Viua VM programs"
layout: default
id: manuals__main_function
summary: >
    Viua VM begins program execution from a main function, which may come in several flavours.
---

<section class="chapter">
    <h1> {{ page.title }} </h1>

    <p class="summary">
        {{ page.summary }}
        These flavours affect the number and type of parameters the main function receives, and
        are mostly a convenience feature as they do not not otherwise affect the main function.
    </p>

    <p>
        There are three flavours of the main function:

        <ul>
            <li> <code>main/0</code> - does not receive any parameters </li>
            <li> <code>main/1</code> - receives a single vector with program name and command line arguments </li>
            <li> <code>main/2</code> - receives a string with program name and a vector with command line arguments </li>
        </ul>

        Source code that will be analysed in this article is presented below.
    </p>

    {% highlight lua %}
-- File: main0.asm

.function: main/0
    izero %0 local
    return
.end
    {% endhighlight %}

    {% highlight lua %}
-- File: main1.asm

.function: main/1
    -- Extract and print first argument, which is a vector of strings.
    arg %1 local %0
    print %1 local

    izero %0 local
    return
.end
    {% endhighlight %}

    {% highlight lua %}
-- File: main2.asm

.function: main/2
    -- Extract and print first argument, which is a string.
    arg %1 local %0
    print %1 local

    -- Extract and print first argument, which is a vector of strings.
    arg %2 local %1
    print %2 local

    izero %0 local
    return
.end
    {% endhighlight %}
</section>

<section class="chapter">
    <h1> <code>main/0</code> </h1>

    <p>
        This kind of function receives no parameters.
        All input must be read from other sources (standard input, network, files, etc.).
    </p>

    <h4> Example invocation </h4>

    {% highlight bash %}
]$ ./build/bin/vm/asm main0.asm
]$ ./build/bin/vm/kernel a.out foo bar
]$ 
    {% endhighlight %}
</section>

<section class="chapter">
    <h1> <code>main/1</code> </h1>

    <p>
        This kind of function receives one parameter: a vector of strings, similar to what is provided <code>argv</code> in main function in C.
    </p>

    <h4> Example invocation </h4>

    {% highlight bash %}
]$ ./build/bin/vm/asm main0.asm
]$ ./build/bin/vm/kernel a.out foo bar
["a.out", "foo", "bar"]
]$ 
    {% endhighlight %}
</section>

<section class="chapter">
    <h1> <code>main/2</code> </h1>

    <p>
        This kind of function receives two parameters.
        The first is a string containing the name with which the program was called.
        The second is a vector of strings, similar to what is provided <code>argv</code> in main function in C but without the name of the program.
    </p>

    <h4> Example invocation </h4>

    {% highlight bash %}
]$ ./build/bin/vm/asm main0.asm
]$ ./build/bin/vm/kernel a.out foo bar
a.out
["foo", "bar"]
]$ 
    {% endhighlight %}
</section>

<section class="chapter">
    <h1> Return value </h1>

    <p>
        Main function is required to return an integer value.
        Failure to meet this requirement will make your program crash (with an appropriate exception) upon returning from main function.
    </p>
</section>
